---
title: "Apartment Rental Prediction System"
author: "Dr. Ivan S. Zapreev"
date: "`r format(Sys.Date())`"
output: pdf_document
---

```{r setup, include=FALSE}
if(!require(knitr)) install.packages("knitr", repos = "http://cran.us.r-project.org")
if(!require(kableExtra)) install.packages("kableExtra", repos = "http://cran.us.r-project.org")
if(!require(graphics)) install.packages("graphics", repos = "http://cran.us.r-project.org")
if(!require(lubridate)) install.packages("lubridate", repos = "http://cran.us.r-project.org")
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(tidyr)) install.packages("tidyr", repos = "http://cran.us.r-project.org")

knitr::opts_chunk$set(echo = TRUE)

library(tidyr)
library(tidyverse)
library(lubridate)
library(graphics)
library(kableExtra)
library(dslabs)

options(digits=7)

MOVIELENS_DATA_FILE_NAME <- "arog_data.rda"
MOVIELENS_REPORT_FILE_NAME <- "arog_report.rda"

#Load the files
load(MOVIELENS_DATA_FILE_NAME)
load(MOVIELENS_REPORT_FILE_NAME)

#--------------------------------------------------------------------
# This function counts the number of N/A entries in the columns of 
# the provided data set, it returns a tibble with the columns:
#    name - storing the column name of the data set
#    count - storing the number of N/A entries
#    percent - storing the percent of N/A entries
#--------------------------------------------------------------------
count_na_entries <- function(data_set) {
  col_names <- names(data_set)
  na_counts <- as.vector(sapply(col_names, function(name){
    return(sum(is.na(data_set[,name])))
  }))
  num_rows <- nrow(data_set)
  percents <- round(na_counts*100/num_rows, 2)
  result <- tibble(name = col_names, 
                count = na_counts,
                percent = percents) %>%
    arrange(desc(count))
  names(result) <- c("Column name", "N/A count", "N/A percent")
  return(result)
}
```

# Introduction
<!-- An introduction/overview/executive summary section that:
 1. Describes the dataset
 2. Summarizes the goal of the project 
 3. Outlines the key steps that were performed; -->


## Dataset overview

As stated on the [webpage](`r arog_report$AROG_DATA_SET_SITE_URL`) of the `r arog_report$AROG_DATA_SET_NAME`, it contains `198,379` rental offers scraped from Germany biggest real estate online platform called [ImmobilienScout24](https://www.immobilienscout24.de/). 

The data set consists of a single CSV file: `r arog_report$AROG_CSV_FILE_NAME` which contains offers for rental properties only. The data features important rental properties, such as living area size, the rent (both base rent as well as total rent), the location, type of energy, and etc. The `date` column present in the data set defines the time of scraping, done on: *2018-09-22*, *2019-05-10* and *2019-10-08*.

The complete list of data set columns is as follows:

```{r, echo = F}
names(arog_data$raw_data)
```
but not all of them will be used in our study. We shall consider the following sub-selection thereof:

1. `hasKitchen` -- has a kitchen
2. `balcony` -- does the object have a balcony
3. `cellar` -- has a cellar
4. `lift` -- is elevator available
5. `floor` -- which floor is the flat on
6. `garden` -- has a garden
7. `noParkSpaces` -- number of parking spaces
8. `livingSpace` -- living space in sqm
9. `condition` -- condition of the flat
10. `interiorQual` -- interior quality

11. `regio1` --  Bundesland
12. `regio2` - District or Kreis, same as geo krs
13. `regio3` -- City/town

14. `noRooms` -- number of rooms
15. `numberOfFloors` -- number of floors in the building
16. `typeOfFlat` -- type of flat
17. `yearConstructed` -- construction year
18. `newlyConst` -- is the building newly constructed
19. `heatingType` -- Type of heating
20. `energyEfficiencyClass` -- energy efficiency class

21. `heatingCosts` -- monthly heating costs in €
22. `serviceCharge` --  auxiliary costs such as electricity or Internet in €
23. `electricityBasePrice` -- monthly base price for electricity in €
24. `baseRent` -- base rent without electricity and heating
25. `totalRent` -- total rent (usually a sum of base rent, service charge and heating cost)

26. `date` -- time of scraping

Which reduces the number of dataset columns from $48$ to $26$ and is motivated by the personal preferences of the author of this report and thus has no scientific motivation. Moreover, this column selection shall be seen as a part of problem statement. In other words, the task is to build an accurate rental price prediction model based on the predictors from this set of columns. The further data pre-processing steps are described and explained in the *"Data wrangling"* section of this document.

## Project goal



## Execution plan


# Data wrangling
<!-- A data wrangling section that explains how the data was prepared for data analysis -->

```{r}
nrow(arog_data$selected_data)
```

```{r, echo=F}
sel_data_na_cnts <- count_na_entries(arog_data$selected_data)

sel_data_na_cnts%>% print(., n=Inf)
```

```{r}
nrow(arog_data$cleaned_data)
```

```{r, echo=F}
clean_data_na_cnts <- count_na_entries(arog_data$cleaned_data)

clean_data_na_cnts%>% print(., n=Inf)
```

```{r, echo = F}
total_rent_na_percent <- sel_data_na_cnts[which(sel_data_na_cnts[,"Column name"] == "totalRent"), "N/A percent"]
selected_wtr <- nrow(arog_data$selected_data) - nrow(arog_data$selected_data)/100*total_rent_na_percent
```

`r round(selected_wtr)` $\approx$ `r nrow(arog_data$cleaned_data)`

# Data analysis
<!-- A data analysis section that:
 1. Explains the process and techniques used, such as:
  1.1 Data exploration
  1.2 Data visualization
 2. Presents insights gained -->

# Modeling approach
<!-- A modeling approach section that explains the modeling approach -->



# Results
<!-- A results section that:
 1. Presents the modeling results 
 2. Discusses the model performance -->



# Conclusions
<!-- A conclusion section that:
 1. Gives a brief summary of the report
 2. Explains its limitations
 3. Suggests future work -->


